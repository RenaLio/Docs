## nat64/dns64概念

`NAT64`是一种有状态的网络地址与协议转换技术，一般只支持通过IPv6网络侧用户发起连接访问`IPv4`侧网络资源。但`NAT64`也支持通过手工配置静态映射关系，实现`IPv4`网络主动发起连接访问`IPv6`网络。`NAT64`可实现`TCP、UDP、ICMP`协议下的`IPv6`与`IPv4`网络地址和协议转换。

`DNS64`则主要是配合`NAT64`工作，主要是将`DNS`查询信息中的A记录（`IPv4`地址）合成到`AAAA`记录（`IPv6`地址）中，返回合成的`AAAA`记录用户给`IPv6`侧用户。`DNS64`也解决了NAT-PT中的`DNS-ALG`存在的缺陷。

![nat64.png](https://cdn.cloudwai.com/blogcdn/2021-04-19/d05145986d24d88ad85c4bbfec2f9a6c.png)

## ipv6访问ipv4网络资源

上面的内容可以当作不知道，简单理解`nat64`将是新的网关，`dns64`会把`ipv4`地址转换为内网`ipv6`
部分网友购买纯`IPV6`的`VPS`后不知道如何玩，不知道如何安装环境。安装大部分基本环境都失败，资源存储在`ipv4`的网络地址上，而我们的`ipv6 vps`并不提供直接访问`ipv4`网络资源，这时我们就需要用到`dns64`服务来实现地址的转换。

## DNS64设置

**通过设置DNS64+NAT64服务，让纯IPV6主机支持IPV4网站访问**

## 备份conf文件

一键命令`mv /etc/resolv.conf /etc/resolv.conf.bak`

## 访问IPv4网站

查看出口地址

`curl myip.ipip.net`

## Google’s DNS64 Service

```
2001:4860:4860::6464
2001:4860:4860::64
```

来源：https://developers.google.com/speed/public-dns/docs/dns64

一键命令`echo -e "nameserver 2001:4860:4860::6464\nnameserver 2001:4860:4860::64" > /etc/resolv.conf`

## 芬兰服务器：

```
2001:67c:2b0::4
2001:67c:2b0::6
```

来源：https://www.trex.fi/2011/dns64.html

一键命令`echo -e "nameserver 2001:67c:2b0::4\nnameserver 2001:67c:2b0::6" > /etc/resolv.conf`

## 德国服务器：

```
2a01:4f8:c2c:123f::1
2a00:1098:2c::1
2a01:4f9:c010:3f02::1
```

来源：https://nat64.net/

一键命令`echo -e "nameserver 2a01:4f8:c2c:123f::1\nnameserver 2a00:1098:2c::1\nnameserver 2a01:4f9:c010:3f02::1" > /etc/resolv.conf`

## 刷新`yum/apt`缓存

刷新一下`yum/apt`缓存即可正常使用

```
#yum
yum clean all
yum makecache
#apt
apt-get update
```

然后你会发现之前无法访问的`ipv4`网站都可以直接访问了

## dns64/nat64缺点

1、网络速度取决于`nat64`网关的性能；

2、网络延迟较大

## 总结

上面分享的是一些公共的`dns64/nat64`服务，性能将由双边网络决定。如果你有`ipv4/ipv6`双栈`vps`，可以尝试自己手动架设一个服务，这样极大程度优化网络性能。如果你想让`ipv4`网络用户可以访问到你的`ipv6`网站，可以使用`cloudflare`的`cdn`加速服务，支持`ipv6`转`ipv4`网络。

## 其他

```
2001:67c:27e4:15::6411
2001:67c:27e4::64
2001:67c:27e4::60
```

来源：https://go6lab.si/current-ipv6-tests/nat64dns64-public-test/

一键命令`echo -e "nameserver 2001:67c:27e4:15::6411\nnameserver 2001:67c:27e4::64\nnameserver 2001:67c:27e4::60" > /etc/resolv.conf`

---

```
2a03:7900:2:0:31:3:104:161
```

来源：[https://www.tuxis.nl/public-doh-dot-dns64-nat64-service/](https://haoduck.com/go.html?url=https://www.tuxis.nl/public-doh-dot-dns64-nat64-service/)

一键命令`echo -e "nameserver 2a03:7900:2:0:31:3:104:161" > /etc/resolv.conf`

> https://nat64.xyz/

| 提供商          | 国家/城市             | DNS64服务                  | NAT64前缀                  |
| --------------- | --------------------- | -------------------------- | -------------------------- |
| Kasper Dupont   | 芬兰/赫尔辛基         | 2a01:4f9:c010:3f02::1      | 2a01:4f9:c010:3f02:64::/96 |
| Trex            | 芬兰/坦佩雷           | 2001:67c:2b0::4            | 2001:67c:2b0:db32::/96     |
| Trex            | 芬兰/坦佩雷           | 2001:67c:2b0::6            | 2001:67c:2b0:db32:0:1::/96 |
| level66.network | 德国/美因河畔法兰克福 | 2a09:11c0:f1:bbf0::70      | 2a09:11c0:f1:be00::/96     |
| Kasper Dupont   | 德国/纽伦堡           | 2a01:4f8:c2c:123f::1       | 2a01:4f8:c2c:123f:64::/96  |
| go6Labs         | 斯洛文尼亚            | 2001:67c:27e4:15::6411     | 2001:67c:27e4:642::/96     |
| go6Labs         | 斯洛文尼亚            | 2001:67c:27e4::64          | 2001:67c:27e4:64::/96      |
| go6Labs         | 斯洛文尼亚            | 2001:67c:27e4:15::64       | 2001:67c:27e4:1064::/96    |
| go6Labs         | 斯洛文尼亚            | 2001:67c:27e4::60          | 2001:67c:27e4:11::/96      |
| Kasper Dupont   | 荷兰/阿姆斯特丹       | 2a00:1098:2b::1            | 2a00:1098:2b::/96          |
| Tuxis           | 荷兰/中部             | 2a03:7900:2:0:31:3:104:161 | 2a03:7900:6446::/96        |
| Kasper Dupont   | 英国/伦敦             | 2a00:1098:2c::1            | 2a00:1098:2c::/96          |

| 提供商                     | 国家/城市             | DNS64服务                  | NAT64前缀                                           |
| :------------------------- | :-------------------- | :------------------------- | :-------------------------------------------------- |
| Cisco                      | 中欧:斯洛文尼亚       | 2001:67c:27e4::60          | *2001:67c:27e4:11::/96* *2001:67c:27e4:11::/64*     |
| Jool                       | 中欧:斯洛文尼亚       | 2001:67c:27e4:15::64       | *2001:67c:27e4:1064::/96* *2001:67c:27e4:1064::/64* |
| A10 Networks               | 中欧:斯洛文尼亚       | 2001:67c:27e4:15::6411     | *2001:67c:27e4:642::/64* *2001:67c:27e4:642::/96*   |
| PaloAlto Networks Firewall | 中欧:斯洛文尼亚       | 2001:67c:27e4::64          | *2001:67c:27e4:64::/96* *2001:67c:27e4:64::/64*     |
| Kasper Dupont              | 芬兰/赫尔辛基         | 2a01:4f9:c010:3f02::1      | 2a01:4f9:c010:3f02:64::/96                          |
| Trex                       | 芬兰/坦佩雷           | 2001:67c:2b0::4            | 2001:67c:2b0:db32::/96                              |
| Trex                       | 芬兰/坦佩雷           | 2001:67c:2b0::6            | 2001:67c:2b0:db32:0:1::/96                          |
| level66.network            | 德国/美因河畔法兰克福 | 2a09:11c0:f1:bbf0::70      | 2a09:11c0:f1:be00::/96                              |
| Kasper Dupont              | 德国/纽伦堡           | 2a01:4f8:c2c:123f::1       | 2a01:4f8:c2c:123f:64::/96                           |
| go6Labs                    | 斯洛文尼亚            | 2001:67c:27e4:15::6411     | 2001:67c:27e4:642::/96                              |
| go6Labs                    | 斯洛文尼亚            | 2001:67c:27e4::64          | 2001:67c:27e4:64::/96                               |
| go6Labs                    | 斯洛文尼亚            | 2001:67c:27e4:15::64       | 2001:67c:27e4:1064::/96                             |
| go6Labs                    | 斯洛文尼亚            | 2001:67c:27e4::60          | 2001:67c:27e4:11::/96                               |
| Kasper Dupont              | 荷兰/阿姆斯特丹       | 2a00:1098:2b::1            | 2a00:1098:2b::/96                                   |
| Tuxis                      | 荷兰/中部             | 2a03:7900:2:0:31:3:104:161 | 2a03:7900:6446::/96                                 |
| Kasper Dupont              | 英国/伦敦             | 2a00:1098:2c::1            | 2a00:1098:2c::/96                                   |